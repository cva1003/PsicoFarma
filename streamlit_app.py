diccionario_combinado = {
    "CYP2D6": {
        "Venlafaxina": {
            "*1/*1xN": "no existe recomendación, no hay evidencias",
            "*1/*2xN": "no existe recomendación, no hay evidencias",
            "*1/*10": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis normal",
            "*1/*41": "Tratamiento con dosis normal",
            "*1/*17": "Tratamiento con dosis normal",
            "*1/*29": "Tratamiento con dosis normal",
            "*1/*10x3": "Tratamiento con dosis normal",
            "*2x2/*10": "Tratamiento con dosis normal",
            "*4/*10": "no existe recomendación, no hay evidencias",
            "*4/*41": "no existe recomendación, no hay evidencias",
            "*10/*10": "no existe recomendación, no hay evidencias",
            "*10/*41": "no existe recomendación, no hay evidencias",
            "*10/*29": "no existe recomendación, no hay evidencias",
            "*9/*14": "no existe recomendación, no hay evidencias",
            "*17/*41": "no existe recomendación, no hay evidencias",
            "*1/*5": "no existe recomendación, no hay evidencias",
            "*1/*4": "no existe recomendación, no hay evidencias",
            "*1/*5": "no existe recomendación, no hay evidencias",
            "*3/*4": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*4/*4": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*5/*5": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*5/*6": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*1/*22": "No recomendaciones",
            "*1/*25": "No recomendaciones",
            "*22/*25": "No recomendaciones"
        },
        "Aripiprazol": {
            "*1/*3xN": "Sin recomendaciones",
            "*2/*3xN": "Sin recomendaciones",
            "*1/*2": "Sin recomendaciones",
            "*2/*2": "Sin recomendaciones",
            "*35/*2": "Sin recomendaciones",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "70% de la dosis máxima",
            "*10/*2": "70% de la dosis máxima",
            "*14": "70% de la dosis máxima",
            "*17": "70% de la dosis máxima",
            "*29": "70% de la dosis máxima",
            "*41": "70% de la dosis máxima",
            "*10": "70% de la dosis máxima",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        },
        "Haloperidol": {
            "*1/*3xN": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*2/*3xN": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*1/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*2/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*35/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "60% de la dosis normal",
            "*10/*2": "60% de la dosis normal",
            "*14": "60% de la dosis normal",
            "*17": "60% de la dosis normal",
            "*29": "60% de la dosis normal",
            "*41": "60% de la dosis normal",
            "*10": "60% de la dosis normal",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        },
        "Risperidona": {
            "*1/*3xN": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*2/*3xN": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*1/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*2/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*35/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*10/*2": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*14": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*17": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*29": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*41": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*10": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        }
    },
    "CYP2C19": {
        "Medicamentos": ["Citalopram", "Escitalopram", "Sertralina", "Venlafaxina"],
        "Tabla": {
            "*17/*17": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Si citalopram o escitalopram son clínicamente apropiados y no se logra eficacia, aumentar dosis",
            "*1/*17": "Tratamiento inicial normal, si el paciente no obtiene respuesta necesaria aumentar dosis o cambiar por un antidepresivo alterativo no metabolizado por CYP2C19.",
            "*1/*1": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*2": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*3": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*3/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*2": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*1/*12": "No recomendaciones",
            "*2/*12": "No recomendaciones",
            "*12/*14": "No recomendaciones"
        }
        
    }
}

import streamlit as st
from fpdf import FPDF
from io import BytesIO
import time


# Función para generar el PDF con el logo centrado
def generar_pdf(nombre, edad, sexo, fecha_nac, ejercicio, alcohol, fumador, gen, medicamento, alelo, recomendacion):
    pdf = FPDF()
    pdf.add_page()
    
    # Tamaño y posición del logo en el PDF
    logo_width = 90  # Anchura del logo en mm
    page_width = 210  # Anchura total de la página A4
    logo_x = (page_width - logo_width) / 2  # Posición horizontal centrada
    logo_y = 20  # Posición vertical

    # Insertar logo
    pdf.image("logo.png", x=logo_x, y=logo_y, w=logo_width)

    # Título debajo del logo
    pdf.set_font("Arial", style="B", size=16)
    pdf.ln(logo_y + 50)  # Espaciado hacia abajo
    pdf.cell(0, 10, "Recomendaciones Farmacogenéticas", ln=True, align="C")
    pdf.ln(10)

    # Línea separadora
    pdf.set_draw_color(0, 123, 255)  # Azul
    pdf.set_line_width(0.5)
    pdf.line(10, pdf.get_y(), 200, pdf.get_y())
    pdf.ln(10)

    # Contenido del PDF
    pdf.set_font("Arial", size=12)
    pdf.set_text_color(0, 0, 0)

    pdf.cell(0, 10, "Información Personal:", ln=True, align="L")
    pdf.cell(0, 10, f"Nombre: {nombre}", ln=True)
    pdf.cell(0, 10, f"Edad: {edad} años", ln=True)
    pdf.cell(0, 10, f"Sexo: {sexo}", ln=True)
    pdf.cell(0, 10, f"Fecha de nacimiento: {fecha_nac}", ln=True)
    pdf.ln(5)

    pdf.cell(0, 10, "Estilo de Vida:", ln=True, align="L")
    pdf.cell(0, 10, f"Ejercicio regular: {'Sí' if ejercicio == 'Sí' else 'No'}", ln=True)
    pdf.cell(0, 10, f"Consumo de alcohol: {'Sí' if alcohol == 'Sí' else 'No'}", ln=True)
    pdf.cell(0, 10, f"Fuma o ha fumado: {'Sí' if fumador == 'Sí' else 'No'}", ln=True)
    pdf.ln(5)

    pdf.cell(0, 10, "Información Genética y Médica:", ln=True, align="L")
    pdf.cell(0, 10, f"Gen seleccionado: {gen}", ln=True)
    pdf.cell(0, 10, f"Medicamento seleccionado: {medicamento}", ln=True)
    pdf.cell(0, 10, f"Alelo seleccionado: {alelo}", ln=True)
    pdf.ln(5)

    pdf.set_text_color(220, 53, 69)
    pdf.cell(0, 10, "Recomendación:", ln=True, align="L")
    pdf.set_text_color(0, 0, 0)
    pdf.multi_cell(0, 10, recomendacion, align="L")
    pdf.ln(5)

    pdf_output = BytesIO()
    pdf_output.write(pdf.output(dest="S").encode("latin1"))
    pdf_output.seek(0)
    return pdf_output

# Centrar logo en la página web
# Configuración de la página principal
st.set_page_config(page_title="Recomendaciones Farmacogenéticas", layout="centered")

# Variables de sesión para el inicio de sesión
if "logged_in" not in st.session_state:
    st.session_state.logged_in = False

if not st.session_state.logged_in:
    # Página de inicio
    st.image("logo.png", width=250)
    st.title("Bienvenido a Recomendaciones Farmacogenéticas")
    st.write("""
        Esta herramienta está diseñada para proporcionar recomendaciones de medicamentos personalizadas basadas en la información genética y el estilo de vida.
        """)
    with st.container():
        st.markdown(
          """
            <div style="display: flex; justify-content: center; align-items: center;">
                <img src="https://media.giphy.com/media/N5Adsn0dgz6h2/giphy.gif?cid=ecf05e47u1b7rvo3ilq8rc2rrnah91kavy10xytdnpzxmc9i&ep=v1_gifs_search&rid=giphy.gif&ct=g" 
                alt="DNA Animation" style="width: 50%; height: auto; transform: rotate(90deg);">
            </div>
        """,
        unsafe_allow_html=True,
    )

    # Inicio de sesión ficticio
    st.subheader("Inicio de Sesión")
    with st.form("login_form"):
        usuario = st.text_input("Usuario", placeholder="Introduce tu usuario")
        contraseña = st.text_input("Contraseña", type="password", placeholder="Introduce tu contraseña")
        enviar = st.form_submit_button("Iniciar sesión")

    if enviar:
        if usuario and contraseña:
            st.success(f"Bienvenido/a, {usuario}.")
            st.session_state.logged_in = True
            time.sleep(1)
            st.experimental_rerun()
        else:
            st.error("Por favor, completa ambos campos para iniciar sesión.")

else:
    # Página principal de la aplicación
    st.image("logo.png", width=250)
    st.title("Recomendaciones Farmacogenéticas")
    st.write("Esta aplicación proporciona recomendaciones basadas en genes y medicamentos.")

    # Formulario de entrada
    nombre = st.text_input("Nombre y apellidos")
    edad = st.number_input("Edad")
    sexo = st.selectbox("Sexo", ["Hombre", "Mujer"])
    fecha_nac = st.date_input("Fecha de nacimiento")
    ejercicio = st.radio("¿Realizas ejercicio regularmente?", ["Sí", "No"])
    alcohol = st.radio("¿Consumes alcohol regularmente?", ["Sí", "No"])
    fumador = st.radio("¿Fumas o has fumado alguna vez?", ["Sí", "No"])
    gen = st.selectbox("Selecciona un gen", ["CYP2D6"])
    medicamento = st.selectbox("Selecciona un medicamento", ["Venlafaxina"])
    alelo = st.selectbox("Selecciona un alelo", ["*1/*10", "*1/*2", "*2/*2"])
    recomendacion = "Tratamiento con dosis normal"  # Este valor puedes calcularlo dinámicamente

    # Mostrar resumen y generar PDF
    if st.button("Generar resumen"):
        st.subheader("Resumen")
        st.write(f"*Nombre:* {nombre}")
        st.write(f"*Edad:* {edad}")
        st.write(f"*Sexo:* {sexo}")
        st.write(f"*Fecha de nacimiento:* {fecha_nac}")
        st.write(f"*Ejercicio regular:* {ejercicio}")
        st.write(f"*Consumo de alcohol:* {alcohol}")
        st.write(f"*Fuma o ha fumado:* {fumador}")
        st.write(f"*Gen seleccionado:* {gen}")
        st.write(f"*Medicamento seleccionado:* {medicamento}")
        st.write(f"*Alelo seleccionado:* {alelo}")
        st.write(f"*Recomendación:* {recomendacion}")

        pdf_data = generar_pdf(
            nombre, edad, sexo, fecha_nac, ejercicio, alcohol, fumador, gen, medicamento, alelo, recomendacion
        )
        st.download_button(
            label="Descargar PDF",
            data=pdf_data,
            file_name="recomendaciones_farmacogeneticas.pdf",
            mime="application/pdf",
            )