diccionario_combinado = {
    "CYP2D6": {
        "Venlafaxina": {
            "*1/*1xN": "no existe recomendación, no hay evidencias",
            "*1/*2xN": "no existe recomendación, no hay evidencias",
            "*1/*10": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis normal",
            "*1/*41": "Tratamiento con dosis normal",
            "*1/*17": "Tratamiento con dosis normal",
            "*1/*29": "Tratamiento con dosis normal",
            "*1/*10x3": "Tratamiento con dosis normal",
            "*2x2/*10": "Tratamiento con dosis normal",
            "*4/*10": "no existe recomendación, no hay evidencias",
            "*4/*41": "no existe recomendación, no hay evidencias",
            "*10/*10": "no existe recomendación, no hay evidencias",
            "*10/*41": "no existe recomendación, no hay evidencias",
            "*10/*29": "no existe recomendación, no hay evidencias",
            "*9/*14": "no existe recomendación, no hay evidencias",
            "*17/*41": "no existe recomendación, no hay evidencias",
            "*1/*5": "no existe recomendación, no hay evidencias",
            "*1/*4": "no existe recomendación, no hay evidencias",
            "*1/*5": "no existe recomendación, no hay evidencias",
            "*3/*4": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*4/*4": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*5/*5": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*5/*6": "Considerar tratamiento que no sea metabolizado CYP2D6",
            "*1/*22": "No recomendaciones",
            "*1/*25": "No recomendaciones",
            "*22/*25": "No recomendaciones"
        },
        "Aripiprazol": {
            "*1/*3xN": "Sin recomendaciones",
            "*2/*3xN": "Sin recomendaciones",
            "*1/*2": "Sin recomendaciones",
            "*2/*2": "Sin recomendaciones",
            "*35/*2": "Sin recomendaciones",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "70% de la dosis máxima",
            "*10/*2": "70% de la dosis máxima",
            "*14": "70% de la dosis máxima",
            "*17": "70% de la dosis máxima",
            "*29": "70% de la dosis máxima",
            "*41": "70% de la dosis máxima",
            "*10": "70% de la dosis máxima",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        },
        "Haloperidol": {
            "*1/*3xN": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*2/*3xN": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*1/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*2/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*35/*2": "Utilizar la dosis normal x1.5 o buscar otro medicamento que no esté sintetizado por CYP2D6",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "60% de la dosis normal",
            "*10/*2": "60% de la dosis normal",
            "*14": "60% de la dosis normal",
            "*17": "60% de la dosis normal",
            "*29": "60% de la dosis normal",
            "*41": "60% de la dosis normal",
            "*10": "60% de la dosis normal",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        },
        "Risperidona": {
            "*1/*3xN": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*2/*3xN": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*1/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*2/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*35/*2": "Ajustar dosis según edad y peso\n(Oral: 12 mg/día para adultos y niños mayores de 15 años con un peso de al menos 51 kg o 6 mg/día para niños mayores de 15 años con un peso menor a 51 kg.\nIntramuscular: 75 mg cada 2 semanas.)",
            "*1": "Sin recomendaciones",
            "*2": "Sin recomendaciones",
            "*9/*2": "Sin recomendaciones",
            "*17/*2": "Sin recomendaciones",
            "*29/*2": "Sin recomendaciones",
            "*33": "Sin recomendaciones",
            "*35": "Sin recomendaciones",
            "*39": "Sin recomendaciones",
            "*41/*2": "Sin recomendaciones",
            "*9": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*10/*2": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*14": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*17": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*29": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*41": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*10": "67% de la dosis normal. Si presenta efectos secundarios, reducir al 50% de la dosis normal.",
            "*3": "Sin recomendación",
            "*3/*2": "Sin recomendación",
            "*4": "Sin recomendación",
            "*4/*2": "Sin recomendación",
            "*5": "Sin recomendación",
            "*6": "Sin recomendación",
            "*6/*2": "Sin recomendación",
            "*7": "Sin recomendación",
            "*8": "Sin recomendación",
            "*11": "Sin recomendación",
            "*12": "Sin recomendación",
            "*13": "Sin recomendación",
            "*15": "Sin recomendación",
            "*18": "Sin recomendación",
            "*19": "Sin recomendación",
            "*20": "Sin recomendación",
            "*21": "Sin recomendación",
            "*31": "Sin recomendación",
            "*36": "Sin recomendación",
            "*36/*2": "Sin recomendación",
            "*38": "Sin recomendación",
            "*40": "Sin recomendación",
            "*42": "Sin recomendación",
            "*114": "Sin recomendación"
        }
    },
    "CYP2C19": {
        "Citalopram":{
            "*17/*17": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Si citalopram o escitalopram son clínicamente apropiados y no se logra eficacia, aumentar dosis",
            "*1/*17": "Tratamiento inicial normal, si el paciente no obtiene respuesta necesaria aumentar dosis o cambiar por un antidepresivo alterativo no metabolizado por CYP2C19.",
            "*1/*1": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*2": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*3": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*3/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*2": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*1/*12": "No recomendaciones",
            "*2/*12": "No recomendaciones",
            "*12/*14": "No recomendaciones"},
        "Escitalopram":{
            "*17/*17": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Si citalopram o escitalopram son clínicamente apropiados y no se logra eficacia, aumentar dosis",
            "*1/*17": "Tratamiento inicial normal, si el paciente no obtiene respuesta necesaria aumentar dosis o cambiar por un antidepresivo alterativo no metabolizado por CYP2C19.",
            "*1/*1": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*2": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*3": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*3/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*2": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*1/*12": "No recomendaciones",
            "*2/*12": "No recomendaciones",
            "*12/*14": "No recomendaciones"
        },
        "Sertralina":{
            "*17/*17": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Si citalopram o escitalopram son clínicamente apropiados y no se logra eficacia, aumentar dosis",
            "*1/*17": "Tratamiento inicial normal, si el paciente no obtiene respuesta necesaria aumentar dosis o cambiar por un antidepresivo alterativo no metabolizado por CYP2C19.",
            "*1/*1": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*2": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*3": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*3/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*2": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*1/*12": "No recomendaciones",
            "*2/*12": "No recomendaciones",
            "*12/*14": "No recomendaciones"
        },
        "Venlafaxina":{
             "*17/*17": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Si citalopram o escitalopram son clínicamente apropiados y no se logra eficacia, aumentar dosis",
            "*1/*17": "Tratamiento inicial normal, si el paciente no obtiene respuesta necesaria aumentar dosis o cambiar por un antidepresivo alterativo no metabolizado por CYP2C19.",
            "*1/*1": "Tratamiento con dosis normal",
            "*1/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*9/*9": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales. ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*2": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*1/*3": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*3/*17": "Tratamiento con dosis inicial recomendada. Considerar programa de valoración más lento o una dosis de mantenimiento más baja que los metabolizadores normales ** Tener cuidado con otros medicamentos ejm: renales e hígado",
            "*2/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*9": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*2": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*3/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*2/*3": "Cambio de antidepresivo por uno no metabolizado por CYP2C19. Reducción al 50% de la dosis. ** dosis de citalopram 20mg/day máxima",
            "*1/*12": "No recomendaciones",
            "*2/*12": "No recomendaciones",
            "*12/*14": "No recomendaciones"
        }      
    }
}

import streamlit as st
from fpdf import FPDF
from io import BytesIO
import time



def generar_pdf(nombre, edad, sexo, fecha_nac, ejercicio, alcohol, fumador, gen, medicamento, alelo, recomendacion, enfermedades):

    pdf = FPDF()
    pdf.add_page()

    # Configuración general del PDF
    pdf.set_auto_page_break(auto=True, margin=15)
    pdf.set_margins(15, 15, 15)

    # Tamaño y posición del logo
    logo_width = 90  # Ancho del logo en mm
    page_width = 210  # Ancho total de la página A4
    logo_x = (page_width - logo_width) / 2  # Posición horizontal centrada
    logo_y = 15  # Posición vertical

    # Insertar logo
    pdf.image("logo.png", x=logo_x, y=logo_y, w=logo_width)

    # Título principal
    pdf.set_font("Arial", style="B", size=18)
    pdf.set_text_color(33, 37, 41)  # Gris oscuro
    pdf.ln(logo_y + 50)  # Espaciado debajo del logo
    pdf.cell(0, 10, "Informe Médico Personalizado", ln=True, align="C")
    pdf.ln(5)

    # Línea separadora
    pdf.set_draw_color(100, 100, 100)  # Gris
    pdf.set_line_width(0.5)
    pdf.line(15, pdf.get_y(), 195, pdf.get_y())
    pdf.ln(10)

    # Información personal
    pdf.set_font("Arial", style="B", size=14)
    pdf.set_text_color(0, 0, 0)
    pdf.cell(0, 10, "1. Información Personal", ln=True, align="L")
    pdf.set_font("Arial", size=12)
    pdf.ln(5)
    pdf.cell(0, 10, f"Nombre: {nombre}", ln=True)
    pdf.cell(0, 10, f"Edad: {edad} años", ln=True)
    pdf.cell(0, 10, f"Sexo: {sexo}", ln=True)
    pdf.cell(0, 10, f"Fecha de nacimiento: {fecha_nac}", ln=True)
    pdf.ln(10)

    # Estilo de vida
    pdf.set_font("Arial", style="B", size=14)
    pdf.cell(0, 10, "2. Estilo de Vida", ln=True, align="L")
    pdf.set_font("Arial", size=12)
    pdf.ln(5)
    pdf.cell(0, 10, f"Ejercicio regular: {'Sí' if ejercicio == 'Sí' else 'No'}", ln=True)
    pdf.cell(0, 10, f"Consumo de alcohol: {'Sí' if alcohol == 'Sí' else 'No'}", ln=True)
    pdf.cell(0, 10, f"Fuma o ha fumado: {'Sí' if fumador == 'Sí' else 'No'}", ln=True)
    pdf.ln(10)

    # Historial médico
    pdf.set_font("Arial", style="B", size=14)
    pdf.cell(0, 10, "3. Historial Médico", ln=True, align="L")
    pdf.set_font("Arial", size=12)
    pdf.ln(5)
    if enfermedades:
        pdf.cell(0, 10, "Enfermedades preexistentes:", ln=True)
        for enfermedad in enfermedades:
            pdf.cell(0, 10, f"- {enfermedad}", ln=True)
    else:
        pdf.cell(0, 10, "No se reportan enfermedades preexistentes.", ln=True)
    pdf.ln(10)


    # Información genética y médica
    pdf.set_font("Arial", style="B", size=14)
    pdf.cell(0, 10, "4. Información Genética y Médica", ln=True, align="L")
    pdf.set_font("Arial", size=12)
    pdf.ln(5)
    pdf.cell(0, 10, f"Gen evaluado: {gen}", ln=True)
    pdf.cell(0, 10, f"Medicamento evaluado: {medicamento}", ln=True)
    pdf.cell(0, 10, f"Alelo identificado: {alelo}", ln=True)
    pdf.ln(10)

    # Recomendaciones
    pdf.set_font("Arial", style="B", size=14)
    pdf.set_text_color(220, 53, 69)  # Rojo profesional
    pdf.cell(0, 10, "5. Recomendación Personalizada", ln=True, align="L")
    pdf.set_font("Arial", size=12)
    pdf.set_text_color(0, 0, 0)
    pdf.ln(5)
    pdf.multi_cell(0, 10, recomendacion, align="J")
    pdf.ln(10)

    # Línea final para cerrar el informe
    pdf.set_draw_color(169, 169, 169)  # Gris claro
    pdf.set_line_width(0.5)
    pdf.line(15, pdf.get_y(), 195, pdf.get_y())
    pdf.ln(10)

    # Salida del PDF
    pdf_output = BytesIO()
    pdf_output.write(pdf.output(dest="S"))
    pdf_output.seek(0)
    return pdf_output

if "enfermedades" not in st.session_state:
    st.session_state["enfermedades"] = []

if "logged_in" not in st.session_state:
    st.session_state.logged_in = False

# Centrar logo en la página web
# Configuración de la página principal
st.set_page_config(page_title="Recomendaciones Farmacogenéticas", layout="centered")

# Variables de sesión para el inicio de sesión


if not st.session_state.logged_in:
    # Página de inicio
    st.image("logo.png", width=250)
    st.title("Bienvenido a Recomendaciones Farmacogenéticas")
    st.write("""
        Esta herramienta está diseñada para proporcionar recomendaciones de medicamentos personalizadas basadas en la información genética y el estilo de vida.
        """)
    with st.container():
        st.markdown(
          """
            <div style="display: flex; justify-content: center; align-items: center;">
                <img src="https://media.giphy.com/media/N5Adsn0dgz6h2/giphy.gif?cid=ecf05e47u1b7rvo3ilq8rc2rrnah91kavy10xytdnpzxmc9i&ep=v1_gifs_search&rid=giphy.gif&ct=g" 
                alt="DNA Animation" style="width: 50%; height: auto; transform: rotate(90deg);">
            </div>
        """,
        unsafe_allow_html=True,
    )

    # Inicio de sesión ficticio
    st.subheader("Inicio de Sesión")
    with st.form("login_form"):
        usuario = st.text_input("Usuario", placeholder="Introduce tu usuario")
        contraseña = st.text_input("Contraseña", type="password", placeholder="Introduce tu contraseña")
        enviar = st.form_submit_button("Iniciar sesión")

    if enviar:
        if usuario and contraseña:
            st.success(f"Bienvenido/a, {usuario}.")
            st.session_state.logged_in = True
            time.sleep(1)
            st.rerun()
        else:
            st.error("Por favor, completa ambos campos para iniciar sesión.")

else:
    # Página principal de la aplicación
    st.image("logo.png", width=250)
    st.title("Recomendaciones Farmacogenéticas")
    st.write("Introduzca los datos del paciente, y luego presione el botón para obtener la recomendación. Para más información visite: [Guías CPIC](https://cpicpgx.org/guidelines/)")

    # Sección 1: Información Personal
    st.header("🧍 Información Personal")
    with st.container():
        col1, col2 = st.columns(2)
        nombre = col1.text_input("Nombre y apellidos")
        edad = col2.number_input("Edad", min_value=0, max_value=120)
        sexo = col1.selectbox("Sexo", ["Hombre", "Mujer", "Otro"])
        fecha_nac = col2.date_input("Fecha de nacimiento")

    st.markdown("---")

    # Sección 2: Estilo de Vida
    st.header("🏋️ Estilo de Vida")
    with st.container():
        ejercicio = st.radio("¿Realiza ejercicio regularmente?", ["Sí", "No"], index=0, horizontal=True)
        alcohol = st.radio("¿Consume alcohol regularmente?", ["Sí", "No"], index=0, horizontal=True)
        fumador = st.radio("¿Fuma o ha fumado alguna vez?", ["Sí", "No"], index=0, horizontal=True)

    st.markdown("---")

    # Sección 3: Historial Médico
    st.header("🩺 Historial Médico")
    historial_medico = st.radio("¿Tienes alguna enfermedad preexistente?", ["Sí", "No"], index=1, horizontal=True)

    # Si el usuario responde "Sí", permite ingresar las enfermedades
    if historial_medico == "Sí":
        st.markdown("### Por favor, indica tus enfermedades preexistentes.")
        enfermedades = st.session_state.get("enfermedades", [])
        nueva_enfermedad = st.text_input("Escribe una enfermedad (o deja en blanco para terminar):", key="input_enfermedad")

        # Botón para agregar enfermedades
        if st.button("Agregar enfermedad"):
            if nueva_enfermedad.strip() != "":
                enfermedades.append(nueva_enfermedad)
                st.session_state["enfermedades"] = enfermedades
                st.success(f"Enfermedad '{nueva_enfermedad}' registrada.")
            else:
                st.warning("El campo está vacío, escribe una enfermedad antes de agregar.")

        # Mostrar las enfermedades registradas
        if enfermedades:
            st.write("Enfermedades registradas: ", ", ".join(enfermedades))
        else:
            st.warning("Aún no se han registrado enfermedades.")

    else:
        st.success("No se reportan enfermedades preexistentes.")
    

    # Sección 3: Selección de Genes y Medicamentos
    st.header("🧬 Selección de Genes y Medicamentos")
    with st.container():
        genes = st.selectbox("Selecciona un gen", ["CYP2D6", "CYP2C19"])
        medicamentos = st.selectbox("Selecciona un medicamento", ["Venlafaxina", "Risperidsona", "Haloperidol","Aripiprazol","Citalopram","Escitalopram","Sertralina"])
        tipos_de_alelo = st.selectbox("Selecciona un alelo", [
    "*1/*1xN", "*1/*2xN", "*1/*10", "*1/*9", "*1/*41", "*1/*17", "*1/*29", "*1/*10x3", "*2x2/*10", 
    "*4/*10", "*4/*41", "*10/*10", "*10/*41", "*10/*29", "*9/*14", "*17/*41", "*1/*5", "*1/*4", "*3/*4", 
    "*4/*4", "*5/*5", "*5/*6", "*1/*22", "*1/*25", "*22/*25", "*1/*3xN", "*2/*3xN", "*1/*2", "*2/*2", "*35/*2", 
    "*1", "*2", "*9/*2", "*17/*2", "*29/*2", "*33", "*35", "*39", "*41/*2", "*9", "*10/*2", "*14", "*3", "*3/*2", 
    "*4", "*4/*2", "*5", "*6", "*6/*2", "*7", "*8", "*11", "*12", "*13", "*15", "*18", "*19", "*20", "*21", "*31", 
    "*36", "*36/*2", "*38", "*40", "*42", "*114", "*17/*17", "*1/*17", "*1/*1", "*1/*9", "*9/*17", "*9/*9", "*1/*2", 
    "*1/*3", "*2/*17", "*3/*17", "*2/*9", "*3/*9", "*2/*2", "*3/*3", "*2/*3", "*1/*12", "*2/*12", "*12/*14"
])

    # Mostrar recomendación
    # Mostrar recomendación
    st.subheader("🔍 Recomendación")
    recomendacion = ""

    # Verificar si el gen está en el diccionario
    if genes in diccionario_combinado:
        # Verificar si el medicamento está listado para el gen
        if medicamentos in diccionario_combinado[genes]:
            # Buscar tratamiento para el alelo seleccionado
            tratamiento = diccionario_combinado[genes][medicamentos].get(tipos_de_alelo, "Alelo no encontrado para este medicamento")
            recomendacion = f"Tratamiento para {medicamentos} y alelo {tipos_de_alelo} en gen {genes}: {tratamiento}"
            st.success(recomendacion)
        else:
            st.warning(f"El medicamento {medicamentos} no está listado para el gen {genes}.")
    else:
        st.warning(f"El gen {genes} no está en el diccionario.")

    # Mostrar recomendación final si existe
    if recomendacion:
        st.subheader("Recomendación Final")
        st.text(recomendacion)


    # Resumen en tarjeta
    st.header("📋 Resumen")
    with st.expander("Mostrar Resumen", expanded=True):
        st.write(f"""
        **Nombre:** {nombre}  
        **Edad:** {edad}  
        **Sexo:** {sexo}  
        **Fecha de nacimiento:** {fecha_nac.strftime('%d/%m/%Y')}  
        **Ejercicio regular:** {ejercicio}  
        **Consumo de alcohol:** {alcohol}  
        **Fuma o ha fumado:** {fumador}  
        **Gen seleccionado:** {genes}  
        **Medicamento seleccionado:** {medicamentos}  
        **Alelo seleccionado:** {tipos_de_alelo}  
        **Recomendación:** {recomendacion}
        """)

    # Botón para descargar PDF
    st.markdown("---")
    if st.button("Descargar resumen en PDF"):
        pdf_data = generar_pdf(
            nombre=nombre,
            edad=edad,
            sexo=sexo,
            fecha_nac=fecha_nac.strftime('%d/%m/%Y'),
            ejercicio=ejercicio,
            enfermedades=enfermedades,
            alcohol=alcohol,
            fumador=fumador,
            gen=genes,
            medicamento=medicamentos,
            alelo=tipos_de_alelo,
            recomendacion=recomendacion
        )
        st.download_button(
            label="📥 Descargar PDF",
            data=pdf_data,
            file_name="recomendaciones_farmacogeneticas.pdf",
            mime="application/pdf",)
